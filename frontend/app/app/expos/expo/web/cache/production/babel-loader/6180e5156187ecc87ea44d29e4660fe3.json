{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import{SyntheticPlatformEmitter}from'@unimodules/core';import{PermissionStatus}from'expo-modules-core';function getStatusFromMedia(media){if(!media){return{isLoaded:false,error:undefined};}var isPlaying=!!(media.currentTime>0&&!media.paused&&!media.ended&&media.readyState>2);var status={isLoaded:true,uri:media.src,progressUpdateIntervalMillis:100,durationMillis:media.duration*1000,positionMillis:media.currentTime*1000,shouldPlay:media.autoplay,isPlaying:isPlaying,isBuffering:false,rate:media.playbackRate,shouldCorrectPitch:false,volume:media.volume,isMuted:media.muted,isLooping:media.loop,didJustFinish:media.ended};return status;}function setStatusForMedia(media,status){if(status.positionMillis!==undefined){media.currentTime=status.positionMillis/1000;}if(status.shouldPlay!==undefined){if(status.shouldPlay){media.play();}else{media.pause();}}if(status.rate!==undefined){media.playbackRate=status.rate;}if(status.volume!==undefined){media.volume=status.volume;}if(status.isMuted!==undefined){media.muted=status.isMuted;}if(status.isLooping!==undefined){media.loop=status.isLooping;}return getStatusFromMedia(media);}export default{get name(){return'ExponentAV';},getStatusForVideo:function getStatusForVideo(element){return _regeneratorRuntime.async(function getStatusForVideo$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",getStatusFromMedia(element));case 1:case\"end\":return _context.stop();}}},null,null,null,Promise);},loadForVideo:function loadForVideo(element,nativeSource,fullInitialStatus){return _regeneratorRuntime.async(function loadForVideo$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",getStatusFromMedia(element));case 1:case\"end\":return _context2.stop();}}},null,null,null,Promise);},unloadForVideo:function unloadForVideo(element){return _regeneratorRuntime.async(function unloadForVideo$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:return _context3.abrupt(\"return\",getStatusFromMedia(element));case 1:case\"end\":return _context3.stop();}}},null,null,null,Promise);},setStatusForVideo:function setStatusForVideo(element,status){return _regeneratorRuntime.async(function setStatusForVideo$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:return _context4.abrupt(\"return\",setStatusForMedia(element,status));case 1:case\"end\":return _context4.stop();}}},null,null,null,Promise);},replayVideo:function replayVideo(element,status){return _regeneratorRuntime.async(function replayVideo$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:return _context5.abrupt(\"return\",setStatusForMedia(element,status));case 1:case\"end\":return _context5.stop();}}},null,null,null,Promise);},setAudioMode:function setAudioMode(){return _regeneratorRuntime.async(function setAudioMode$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:case\"end\":return _context6.stop();}}},null,null,null,Promise);},setAudioIsEnabled:function setAudioIsEnabled(){return _regeneratorRuntime.async(function setAudioIsEnabled$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:case\"end\":return _context7.stop();}}},null,null,null,Promise);},getStatusForSound:function getStatusForSound(element){return _regeneratorRuntime.async(function getStatusForSound$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:return _context8.abrupt(\"return\",getStatusFromMedia(element));case 1:case\"end\":return _context8.stop();}}},null,null,null,Promise);},loadForSound:function loadForSound(nativeSource,fullInitialStatus){var source,media,status;return _regeneratorRuntime.async(function loadForSound$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:source=typeof nativeSource==='string'?nativeSource:nativeSource.uri;media=new Audio(source);media.ontimeupdate=function(){SyntheticPlatformEmitter.emit('didUpdatePlaybackStatus',{key:media,status:getStatusFromMedia(media)});};media.onerror=function(){SyntheticPlatformEmitter.emit('ExponentAV.onError',{key:media,error:media.error.message});};status=setStatusForMedia(media,fullInitialStatus);return _context9.abrupt(\"return\",[media,status]);case 6:case\"end\":return _context9.stop();}}},null,null,null,Promise);},unloadForSound:function unloadForSound(element){return _regeneratorRuntime.async(function unloadForSound$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:element.pause();element.removeAttribute('src');element.load();return _context10.abrupt(\"return\",getStatusFromMedia(element));case 4:case\"end\":return _context10.stop();}}},null,null,null,Promise);},setStatusForSound:function setStatusForSound(element,status){return _regeneratorRuntime.async(function setStatusForSound$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:return _context11.abrupt(\"return\",setStatusForMedia(element,status));case 1:case\"end\":return _context11.stop();}}},null,null,null,Promise);},replaySound:function replaySound(element,status){return _regeneratorRuntime.async(function replaySound$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:return _context12.abrupt(\"return\",setStatusForMedia(element,status));case 1:case\"end\":return _context12.stop();}}},null,null,null,Promise);},getAudioRecordingStatus:function getAudioRecordingStatus(){return _regeneratorRuntime.async(function getAudioRecordingStatus$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:case\"end\":return _context13.stop();}}},null,null,null,Promise);},prepareAudioRecorder:function prepareAudioRecorder(){return _regeneratorRuntime.async(function prepareAudioRecorder$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:case\"end\":return _context14.stop();}}},null,null,null,Promise);},startAudioRecording:function startAudioRecording(){return _regeneratorRuntime.async(function startAudioRecording$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:case\"end\":return _context15.stop();}}},null,null,null,Promise);},pauseAudioRecording:function pauseAudioRecording(){return _regeneratorRuntime.async(function pauseAudioRecording$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:case\"end\":return _context16.stop();}}},null,null,null,Promise);},stopAudioRecording:function stopAudioRecording(){return _regeneratorRuntime.async(function stopAudioRecording$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:case\"end\":return _context17.stop();}}},null,null,null,Promise);},unloadAudioRecorder:function unloadAudioRecorder(){return _regeneratorRuntime.async(function unloadAudioRecorder$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:case\"end\":return _context18.stop();}}},null,null,null,Promise);},getPermissionsAsync:function getPermissionsAsync(){return _regeneratorRuntime.async(function getPermissionsAsync$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:return _context19.abrupt(\"return\",{status:PermissionStatus.DENIED,expires:'never',canAskAgain:false,granted:false});case 1:case\"end\":return _context19.stop();}}},null,null,null,Promise);},requestPermissionsAsync:function requestPermissionsAsync(){return _regeneratorRuntime.async(function requestPermissionsAsync$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:return _context20.abrupt(\"return\",this.getPermissionsAsync());case 1:case\"end\":return _context20.stop();}}},null,this,null,Promise);}};","map":{"version":3,"sources":["../src/ExponentAV.web.ts"],"names":[],"mappings":"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","sourcesContent":["import { SyntheticPlatformEmitter } from '@unimodules/core';\nimport { PermissionResponse, PermissionStatus } from 'expo-modules-core';\n\nimport { AVPlaybackNativeSource, AVPlaybackStatus, AVPlaybackStatusToSet } from './AV';\n\nfunction getStatusFromMedia(media?: HTMLMediaElement): AVPlaybackStatus {\n  if (!media) {\n    return {\n      isLoaded: false,\n      error: undefined,\n    };\n  }\n\n  const isPlaying = !!(\n    media.currentTime > 0 &&\n    !media.paused &&\n    !media.ended &&\n    media.readyState > 2\n  );\n\n  const status: AVPlaybackStatus = {\n    isLoaded: true,\n    uri: media.src,\n    progressUpdateIntervalMillis: 100, //TODO: Bacon: Add interval between calls\n    durationMillis: media.duration * 1000,\n    positionMillis: media.currentTime * 1000,\n    // playableDurationMillis: media.buffered * 1000,\n    // seekMillisToleranceBefore?: number\n    // seekMillisToleranceAfter?: number\n    shouldPlay: media.autoplay,\n    isPlaying,\n    isBuffering: false, //media.waiting,\n    rate: media.playbackRate,\n    // TODO: Bacon: This seems too complicated right now: https://webaudio.github.io/web-audio-api/#dom-biquadfilternode-frequency\n    shouldCorrectPitch: false,\n    volume: media.volume,\n    isMuted: media.muted,\n    isLooping: media.loop,\n    didJustFinish: media.ended,\n  };\n\n  return status;\n}\n\nfunction setStatusForMedia(\n  media: HTMLMediaElement,\n  status: AVPlaybackStatusToSet\n): AVPlaybackStatus {\n  if (status.positionMillis !== undefined) {\n    media.currentTime = status.positionMillis / 1000;\n  }\n  // if (status.progressUpdateIntervalMillis !== undefined) {\n  //   media.progressUpdateIntervalMillis = status.progressUpdateIntervalMillis;\n  // }\n  // if (status.seekMillisToleranceBefore !== undefined) {\n  //   media.seekMillisToleranceBefore = status.seekMillisToleranceBefore;\n  // }\n  // if (status.seekMillisToleranceAfter !== undefined) {\n  //   media.seekMillisToleranceAfter = status.seekMillisToleranceAfter;\n  // }\n  // if (status.shouldCorrectPitch !== undefined) {\n  //   media.shouldCorrectPitch = status.shouldCorrectPitch;\n  // }\n  if (status.shouldPlay !== undefined) {\n    if (status.shouldPlay) {\n      media.play();\n    } else {\n      media.pause();\n    }\n  }\n  if (status.rate !== undefined) {\n    media.playbackRate = status.rate;\n  }\n  if (status.volume !== undefined) {\n    media.volume = status.volume;\n  }\n  if (status.isMuted !== undefined) {\n    media.muted = status.isMuted;\n  }\n  if (status.isLooping !== undefined) {\n    media.loop = status.isLooping;\n  }\n\n  return getStatusFromMedia(media);\n}\n\nexport default {\n  get name(): string {\n    return 'ExponentAV';\n  },\n  async getStatusForVideo(element: HTMLMediaElement): Promise<AVPlaybackStatus> {\n    return getStatusFromMedia(element);\n  },\n  async loadForVideo(\n    element: HTMLMediaElement,\n    nativeSource: AVPlaybackNativeSource,\n    fullInitialStatus: AVPlaybackStatusToSet\n  ): Promise<AVPlaybackStatus> {\n    return getStatusFromMedia(element);\n  },\n  async unloadForVideo(element: HTMLMediaElement): Promise<AVPlaybackStatus> {\n    return getStatusFromMedia(element);\n  },\n  async setStatusForVideo(\n    element: HTMLMediaElement,\n    status: AVPlaybackStatusToSet\n  ): Promise<AVPlaybackStatus> {\n    return setStatusForMedia(element, status);\n  },\n  async replayVideo(\n    element: HTMLMediaElement,\n    status: AVPlaybackStatusToSet\n  ): Promise<AVPlaybackStatus> {\n    return setStatusForMedia(element, status);\n  },\n  /* Audio */\n  async setAudioMode() {},\n  async setAudioIsEnabled() {},\n  async getStatusForSound(element: HTMLMediaElement) {\n    return getStatusFromMedia(element);\n  },\n  async loadForSound(\n    nativeSource: string | { uri: string; [key: string]: any },\n    fullInitialStatus: AVPlaybackStatusToSet\n  ): Promise<[HTMLMediaElement, AVPlaybackStatus]> {\n    const source = typeof nativeSource === 'string' ? nativeSource : nativeSource.uri;\n    const media = new Audio(source);\n\n    media.ontimeupdate = () => {\n      SyntheticPlatformEmitter.emit('didUpdatePlaybackStatus', {\n        key: media,\n        status: getStatusFromMedia(media),\n      });\n    };\n\n    media.onerror = () => {\n      SyntheticPlatformEmitter.emit('ExponentAV.onError', {\n        key: media,\n        error: media.error!.message,\n      });\n    };\n\n    const status = setStatusForMedia(media, fullInitialStatus);\n\n    return [media, status];\n  },\n  async unloadForSound(element: HTMLMediaElement) {\n    element.pause();\n    element.removeAttribute('src');\n    element.load();\n    return getStatusFromMedia(element);\n  },\n  async setStatusForSound(\n    element: HTMLMediaElement,\n    status: AVPlaybackStatusToSet\n  ): Promise<AVPlaybackStatus> {\n    return setStatusForMedia(element, status);\n  },\n  async replaySound(\n    element: HTMLMediaElement,\n    status: AVPlaybackStatusToSet\n  ): Promise<AVPlaybackStatus> {\n    return setStatusForMedia(element, status);\n  },\n\n  /* Recording */\n  //   async setUnloadedCallbackForAndroidRecording() {},\n  async getAudioRecordingStatus() {},\n  async prepareAudioRecorder() {},\n  async startAudioRecording() {},\n  async pauseAudioRecording() {},\n  async stopAudioRecording() {},\n  async unloadAudioRecorder() {},\n\n  // Recording isn't available on the web\n  async getPermissionsAsync(): Promise<PermissionResponse> {\n    return {\n      status: PermissionStatus.DENIED,\n      expires: 'never',\n      canAskAgain: false,\n      granted: false,\n    };\n  },\n\n  // Recording isn't available on the web\n  async requestPermissionsAsync(): Promise<PermissionResponse> {\n    return this.getPermissionsAsync();\n  },\n};\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}