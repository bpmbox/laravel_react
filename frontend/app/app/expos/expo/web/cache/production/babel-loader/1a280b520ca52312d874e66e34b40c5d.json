{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import React,{useEffect,useState}from\"react\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import SafeAreaView from\"react-native-web/dist/exports/SafeAreaView\";import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import Image from\"react-native-web/dist/exports/Image\";import TouchableOpacity from\"react-native-web/dist/exports/TouchableOpacity\";import FlatList from\"react-native-web/dist/exports/FlatList\";import{Audio}from\"expo-av\";import Constants from\"expo-constants\";import PlayerModal from\"./PlayerModal\";import{displayTime}from\"./util\";import{styles}from\"./MusicPlayer.style\";import{PLAY_LIST}from\"./listSong\";export default function MusicPlayer(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isModalVisible=_useState2[0],setModalVisible=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),playingSong=_useState4[0],setPlayingSong=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isBuffering=_useState6[0],setBuffering=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isPlaying=_useState8[0],setPlaying=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),isRewinding=_useState10[0],setRewinding=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),currentPosition=_useState12[0],setcurrentPosition=_useState12[1];var _useState13=useState(0),_useState14=_slicedToArray(_useState13,2),currentSongIndex=_useState14[0],setCurrentSongIndex=_useState14[1];var _useState15=useState(null),_useState16=_slicedToArray(_useState15,2),playbackObject=_useState16[0],setPlaybackObject=_useState16[1];var renderHeader=function renderHeader(){return React.createElement(View,{style:styles.header},React.createElement(Text,{style:styles.headerTitle},\"List Song\"));};var renderItem=function renderItem(_ref){var item=_ref.item,index=_ref.index;return React.createElement(TouchableOpacity,{style:styles.listItem,onPress:function onPress(){return playSong(item,index);}},React.createElement(Image,{source:{uri:item.coverImage},style:styles.coverImage}),React.createElement(View,{style:{flex:1}},React.createElement(Text,{style:styles.songName},item.name),React.createElement(View,{style:styles.songInfo},React.createElement(Text,{style:styles.singerName},item.singer),React.createElement(Text,{style:styles.songDuration},displayTime(item.duration)))));};var keyExtractor=function keyExtractor(item){return item.sourceUri;};var playSong=function playSong(song,index){var _await$Audio$Sound$cr,sound;return _regeneratorRuntime.async(function playSong$(_context){while(1){switch(_context.prev=_context.next){case 0:setModalVisible(true);setBuffering(true);setPlaying(false);setcurrentPosition(0);setCurrentSongIndex(index);setPlayingSong(song);_context.prev=6;if(!(playbackObject!==null)){_context.next=10;break;}_context.next=10;return _regeneratorRuntime.awrap(playbackObject.unloadAsync());case 10:_context.next=12;return _regeneratorRuntime.awrap(Audio.Sound.createAsync({uri:song.sourceUri},{shouldPlay:true}));case 12:_await$Audio$Sound$cr=_context.sent;sound=_await$Audio$Sound$cr.sound;sound.setOnPlaybackStatusUpdate(onPlaybackStatusUpdate);setPlaybackObject(sound);_context.next=21;break;case 18:_context.prev=18;_context.t0=_context[\"catch\"](6);alert(\"Can't play this song!\");case 21:case\"end\":return _context.stop();}}},null,null,[[6,18]],Promise);};var onPlaybackStatusUpdate=function onPlaybackStatusUpdate(_ref2){var isLoaded=_ref2.isLoaded,isBuffering=_ref2.isBuffering,isPlaying=_ref2.isPlaying,error=_ref2.error;if(!isLoaded){if(error){alert(\"Encountered a fatal error during playback: \"+error);}}else{setBuffering(isBuffering);setPlaying(isPlaying);}};var updatePosition=function updatePosition(position){return _regeneratorRuntime.async(function updatePosition$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return _regeneratorRuntime.awrap(playbackObject.setPositionAsync(position));case 2:setcurrentPosition(position);setRewinding(false);case 4:case\"end\":return _context2.stop();}}},null,null,null,Promise);};var pauseOrResumeSong=function pauseOrResumeSong(){return _regeneratorRuntime.async(function pauseOrResumeSong$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!isPlaying){_context3.next=5;break;}setPlaying(false);playbackObject.pauseAsync();_context3.next=13;break;case 5:if(!(currentPosition===playingSong.duration)){_context3.next=11;break;}setcurrentPosition(0);_context3.next=9;return _regeneratorRuntime.awrap(playbackObject.replayAsync());case 9:_context3.next=13;break;case 11:_context3.next=13;return _regeneratorRuntime.awrap(playbackObject.playAsync());case 13:case\"end\":return _context3.stop();}}},null,null,null,Promise);};var changeSong=function changeSong(index){if(index<0)index=PLAY_LIST.length-1;else if(index==PLAY_LIST.length)index=0;playSong(PLAY_LIST[index],index);};var stopPlaySong=function stopPlaySong(){setModalVisible(false);setPlaying(false);playbackObject.unloadAsync();};useEffect(function(){if(isPlaying&&!isBuffering){var interval=setInterval(function _callee(){var _await$playbackObject,positionMillis,durationMillis;return _regeneratorRuntime.async(function _callee$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return _regeneratorRuntime.awrap(playbackObject.getStatusAsync());case 2:_await$playbackObject=_context4.sent;positionMillis=_await$playbackObject.positionMillis;durationMillis=_await$playbackObject.durationMillis;if(!isRewinding)setcurrentPosition(positionMillis||0);if(!(positionMillis>=durationMillis-900)){_context4.next=12;break;}_context4.next=9;return _regeneratorRuntime.awrap(playbackObject.setPositionAsync(durationMillis));case 9:setcurrentPosition(durationMillis);setPlaying(false);clearInterval(interval);case 12:case\"end\":return _context4.stop();}}},null,null,null,Promise);},1000);return function(){return clearInterval(interval);};}},[isPlaying,isBuffering,isRewinding]);return React.createElement(SafeAreaView,{style:styles.container},React.createElement(FlatList,{data:PLAY_LIST,renderItem:renderItem,ListHeaderComponent:renderHeader,keyExtractor:keyExtractor,showsVerticalScrollIndicator:false}),React.createElement(PlayerModal,{isModalVisible:isModalVisible,closeModal:stopPlaySong,playingSong:playingSong,isPlaying:isPlaying,isBuffering:isBuffering,currentSongIndex:currentSongIndex,currentPosition:currentPosition,setcurrentPosition:setcurrentPosition,setRewinding:setRewinding,updatePosition:updatePosition,pauseOrResumeSong:pauseOrResumeSong,changeSong:changeSong}));}","map":{"version":3,"sources":["/app/examples/10-music-player/MusicPlayer.js"],"names":["React","useEffect","useState","Audio","Constants","PlayerModal","displayTime","styles","PLAY_LIST","MusicPlayer","isModalVisible","setModalVisible","playingSong","setPlayingSong","isBuffering","setBuffering","isPlaying","setPlaying","isRewinding","setRewinding","currentPosition","setcurrentPosition","currentSongIndex","setCurrentSongIndex","playbackObject","setPlaybackObject","renderHeader","header","headerTitle","renderItem","item","index","listItem","playSong","uri","coverImage","flex","songName","name","songInfo","singerName","singer","songDuration","duration","keyExtractor","sourceUri","song","unloadAsync","Sound","createAsync","shouldPlay","sound","setOnPlaybackStatusUpdate","onPlaybackStatusUpdate","alert","isLoaded","error","updatePosition","position","setPositionAsync","pauseOrResumeSong","pauseAsync","replayAsync","playAsync","changeSong","length","stopPlaySong","interval","setInterval","getStatusAsync","positionMillis","durationMillis","clearInterval","container"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport {\n  StyleSheet,\n  SafeAreaView,\n  View,\n  Text,\n  Image,\n  TouchableOpacity,\n  FlatList,\n} from \"react-native\";\nimport { Audio } from \"expo-av\";\nimport Constants from \"expo-constants\";\nimport PlayerModal from \"./PlayerModal\";\nimport { displayTime } from \"./util\";\nimport { styles } from \"./MusicPlayer.style\";\nimport { PLAY_LIST } from \"./listSong\";\n\nexport default function MusicPlayer() {\n  const [isModalVisible, setModalVisible] = useState(false);\n  const [playingSong, setPlayingSong] = useState({});\n  const [isBuffering, setBuffering] = useState(false);\n  const [isPlaying, setPlaying] = useState(false);\n  const [isRewinding, setRewinding] = useState(false);\n  const [currentPosition, setcurrentPosition] = useState(0);\n  const [currentSongIndex, setCurrentSongIndex] = useState(0);\n  const [playbackObject, setPlaybackObject] = useState(null);\n\n  const renderHeader = () => (\n    <View style={styles.header}>\n      <Text style={styles.headerTitle}>List Song</Text>\n    </View>\n  );\n\n  const renderItem = ({ item, index }) => (\n    <TouchableOpacity\n      style={styles.listItem}\n      onPress={() => playSong(item, index)}\n    >\n      <Image source={{ uri: item.coverImage }} style={styles.coverImage} />\n\n      <View style={{ flex: 1 }}>\n        <Text style={styles.songName}>{item.name}</Text>\n\n        <View style={styles.songInfo}>\n          <Text style={styles.singerName}>{item.singer}</Text>\n          <Text style={styles.songDuration}>{displayTime(item.duration)}</Text>\n        </View>\n      </View>\n    </TouchableOpacity>\n  );\n\n  const keyExtractor = (item) => item.sourceUri;\n\n  const playSong = async (song, index) => {\n    setModalVisible(true);\n    setBuffering(true);\n    setPlaying(false);\n    setcurrentPosition(0);\n    setCurrentSongIndex(index);\n    setPlayingSong(song);\n\n    try {\n      // Unload playback when change sound\n      if (playbackObject !== null) {\n        await playbackObject.unloadAsync();\n      }\n\n      // Play new sound\n      const { sound } = await Audio.Sound.createAsync(\n        { uri: song.sourceUri },\n        { shouldPlay: true }\n      );\n      sound.setOnPlaybackStatusUpdate(onPlaybackStatusUpdate);\n      setPlaybackObject(sound);\n    } catch (error) {\n      alert(\"Can't play this song!\");\n    }\n  };\n\n  const onPlaybackStatusUpdate = ({\n    isLoaded,\n    isBuffering,\n    isPlaying,\n    error,\n  }) => {\n    if (!isLoaded) {\n      if (error) {\n        alert(`Encountered a fatal error during playback: ${error}`);\n      }\n    } else {\n      setBuffering(isBuffering);\n      setPlaying(isPlaying);\n    }\n  };\n\n  const updatePosition = async (position) => {\n    await playbackObject.setPositionAsync(position);\n    setcurrentPosition(position);\n    setRewinding(false);\n  };\n\n  const pauseOrResumeSong = async () => {\n    if (isPlaying) {\n      setPlaying(false);\n      playbackObject.pauseAsync();\n    } else {\n      if (currentPosition === playingSong.duration) {\n        setcurrentPosition(0);\n        await playbackObject.replayAsync();\n      } else {\n        await playbackObject.playAsync();\n      }\n    }\n  };\n\n  const changeSong = (index) => {\n    if (index < 0) index = PLAY_LIST.length - 1;\n    else if (index == PLAY_LIST.length) index = 0;\n\n    playSong(PLAY_LIST[index], index);\n  };\n\n  const stopPlaySong = () => {\n    setModalVisible(false);\n    setPlaying(false);\n    playbackObject.unloadAsync();\n  };\n\n  // https://reactjs.org/docs/hooks-effect.html\n  useEffect(() => {\n    // Run time slider\n    if (isPlaying && !isBuffering) {\n      const interval = setInterval(async () => {\n        const {\n          positionMillis,\n          durationMillis,\n        } = await playbackObject.getStatusAsync();\n\n        // Don't update position when user rewinding\n        if (!isRewinding) setcurrentPosition(positionMillis || 0);\n\n        // Stop sound if positionMillis equals durationMillis or less than 1 second\n        if (positionMillis >= durationMillis - 900) {\n          await playbackObject.setPositionAsync(durationMillis);\n          setcurrentPosition(durationMillis);\n          setPlaying(false);\n          clearInterval(interval);\n        }\n      }, 1000);\n\n      return () => clearInterval(interval);\n    }\n  }, [isPlaying, isBuffering, isRewinding]);\n\n  return (\n    <SafeAreaView style={styles.container}>\n      <FlatList\n        data={PLAY_LIST}\n        renderItem={renderItem}\n        ListHeaderComponent={renderHeader}\n        keyExtractor={keyExtractor}\n        showsVerticalScrollIndicator={false}\n      />\n\n      <PlayerModal\n        isModalVisible={isModalVisible}\n        closeModal={stopPlaySong}\n        playingSong={playingSong}\n        isPlaying={isPlaying}\n        isBuffering={isBuffering}\n        currentSongIndex={currentSongIndex}\n        currentPosition={currentPosition}\n        setcurrentPosition={setcurrentPosition}\n        setRewinding={setRewinding}\n        updatePosition={updatePosition}\n        pauseOrResumeSong={pauseOrResumeSong}\n        changeSong={changeSong}\n      />\n    </SafeAreaView>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}