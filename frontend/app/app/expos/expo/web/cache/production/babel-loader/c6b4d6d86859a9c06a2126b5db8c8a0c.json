{"ast":null,"code":"import _extends from\"@babel/runtime/helpers/extends\";import _defineProperty from\"@babel/runtime/helpers/defineProperty\";import _classCallCheck from\"@babel/runtime/helpers/classCallCheck\";import _createClass from\"@babel/runtime/helpers/createClass\";import _inherits from\"@babel/runtime/helpers/inherits\";import _possibleConstructorReturn from\"@babel/runtime/helpers/possibleConstructorReturn\";import _getPrototypeOf from\"@babel/runtime/helpers/getPrototypeOf\";function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});}keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect===\"undefined\"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy===\"function\")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}import _ from'lodash';import PropTypes from'prop-types';import XDate from'xdate';import memoize from'memoize-one';import React,{Component}from'react';import Text from\"react-native-web/dist/exports/Text\";import View from\"react-native-web/dist/exports/View\";import Dimensions from\"react-native-web/dist/exports/Dimensions\";import Animated from\"react-native-web/dist/exports/Animated\";import{extractComponentProps}from\"../component-updater.js\";import{parseDate,xdateToData,toMarkingFormat}from\"../interface\";import{weekDayNames,sameDate,sameMonth}from\"../dateutils\";import{AGENDA_CALENDAR_KNOB}from\"../testIDs\";import{VelocityTracker}from\"../input\";import styleConstructor from\"./style\";import CalendarList from\"../calendar-list\";import ReservationList from\"./reservation-list\";var HEADER_HEIGHT=104;var KNOB_HEIGHT=24;var Agenda=function(_Component){_inherits(Agenda,_Component);var _super=_createSuper(Agenda);function Agenda(props){var _this;_classCallCheck(this,Agenda);_this=_super.call(this,props);_this.scrollPad=React.createRef();_this.calendar=React.createRef();_this.knob=React.createRef();_this.list=React.createRef();_this.initialScrollPadPosition=function(){return Math.max(0,_this.viewHeight-HEADER_HEIGHT);};_this.setScrollPadPosition=function(y,animated){var _this$scrollPad,_this$scrollPad$curre;if((_this$scrollPad=_this.scrollPad)!=null&&(_this$scrollPad$curre=_this$scrollPad.current)!=null&&_this$scrollPad$curre.scrollTo){_this.scrollPad.current.scrollTo({x:0,y:y,animated:animated});}else{var _this$scrollPad2,_this$scrollPad2$curr;(_this$scrollPad2=_this.scrollPad)==null?void 0:(_this$scrollPad2$curr=_this$scrollPad2.current)==null?void 0:_this$scrollPad2$curr.getNode().scrollTo({x:0,y:y,animated:animated});}};_this.toggleCalendarPosition=function(open){var maxY=_this.initialScrollPadPosition();_this.setScrollPadPosition(open?0:maxY,true);_this.enableCalendarScrolling(open);};_this.chooseDayFromCalendar=function(d){_this.chooseDay(d,!_this.state.calendarScrollable);};_this.generateMarkings=memoize(function(selectedDay,markedDates){var items=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(!markedDates){markedDates={};Object.keys(items).forEach(function(key){if(items[key]&&items[key].length){markedDates[key]={marked:true};}});}var key=toMarkingFormat(selectedDay);return _objectSpread(_objectSpread({},markedDates),{},_defineProperty({},key,_objectSpread(_objectSpread({},markedDates[key]||{}),{selected:true})));});_this.onScrollPadLayout=function(){_this.setScrollPadPosition(_this.initialScrollPadPosition(),false);setTimeout(function(){return _this.setState({calendarIsReady:true});},0);};_this.onCalendarListLayout=function(){var _this$calendar,_this$calendar$curren;(_this$calendar=_this.calendar)==null?void 0:(_this$calendar$curren=_this$calendar.current)==null?void 0:_this$calendar$curren.scrollToDay(_this.state.selectedDay.clone(),_this.calendarOffset(),false);};_this.onLayout=function(event){_this.viewHeight=event.nativeEvent.layout.height;_this.viewWidth=event.nativeEvent.layout.width;_this.forceUpdate();};_this.onTouchStart=function(){var _this$knob,_this$knob$current;_this.headerState='touched';(_this$knob=_this.knob)==null?void 0:(_this$knob$current=_this$knob.current)==null?void 0:_this$knob$current.setNativeProps({style:{opacity:0.5}});};_this.onTouchEnd=function(){var _this$knob2,_this$knob2$current;(_this$knob2=_this.knob)==null?void 0:(_this$knob2$current=_this$knob2.current)==null?void 0:_this$knob2$current.setNativeProps({style:{opacity:1}});if(_this.headerState==='touched'){var isOpen=_this.state.calendarScrollable;_this.toggleCalendarPosition(!isOpen);}_this.headerState='idle';};_this.onStartDrag=function(){_this.headerState='dragged';_this.knobTracker.reset();};_this.onSnapAfterDrag=function(e){_this.onTouchEnd();var currentY=e.nativeEvent.contentOffset.y;_this.knobTracker.add(currentY);var projectedY=currentY+_this.knobTracker.estimateSpeed()*250;var maxY=_this.initialScrollPadPosition();var snapY=projectedY>maxY/2?maxY:0;_this.setScrollPadPosition(snapY,true);_this.enableCalendarScrolling(snapY===0);};_this.onVisibleMonthsChange=function(months){_.invoke(_this.props,'onVisibleMonthsChange',months);if(_this.props.items&&!_this.state.firstReservationLoad){clearTimeout(_this.scrollTimeout);_this.scrollTimeout=setTimeout(function(){if(_this._isMounted){_.invoke(_this.props,'loadItemsForMonth',months[0]);}},200);}};_this.onDayChange=function(day){var _this$calendar2,_this$calendar2$curre;var newDate=parseDate(day);var withAnimation=sameMonth(newDate,_this.state.selectedDay);(_this$calendar2=_this.calendar)==null?void 0:(_this$calendar2$curre=_this$calendar2.current)==null?void 0:_this$calendar2$curre.scrollToDay(day,_this.calendarOffset(),withAnimation);_this.setState({selectedDay:newDate});_.invoke(_this.props,'onDayChange',xdateToData(newDate));};_this.renderWeekDaysNames=memoize(function(weekDaysNames){return weekDaysNames.map(function(day,index){return React.createElement(Text,{allowFontScaling:false,key:day+index,style:_this.style.weekday,numberOfLines:1},day);});});_this.renderWeekNumbersSpace=function(){return _this.props.showWeekNumbers&&React.createElement(View,{style:_this.style.weekday});};_this.style=styleConstructor(props.theme);var windowSize=Dimensions.get('window');_this.viewHeight=windowSize.height;_this.viewWidth=windowSize.width;_this.scrollTimeout=undefined;_this.headerState='idle';_this.state={scrollY:new Animated.Value(0),calendarIsReady:false,calendarScrollable:false,firstReservationLoad:false,selectedDay:parseDate(props.selected)||new XDate(true),topDay:parseDate(props.selected)||new XDate(true)};_this.currentMonth=_this.state.selectedDay.clone();_this.knobTracker=new VelocityTracker();_this.state.scrollY.addListener(function(_ref){var value=_ref.value;return _this.knobTracker.add(value);});return _this;}_createClass(Agenda,[{key:\"componentDidMount\",value:function componentDidMount(){this._isMounted=true;this.loadReservations(this.props);}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this._isMounted=false;this.state.scrollY.removeAllListeners();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(prevProps){if(this.props.selected&&!sameDate(parseDate(this.props.selected),parseDate(prevProps.selected))){this.setState({selectedDay:parseDate(this.props.selected)});}else if(!prevProps.items){this.loadReservations(this.props);}}},{key:\"calendarOffset\",value:function calendarOffset(){return 96-this.viewHeight/2;}},{key:\"enableCalendarScrolling\",value:function enableCalendarScrolling(){var _this$calendar3,_this$calendar3$curre;var enable=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.setState({calendarScrollable:enable});_.invoke(this.props,'onCalendarToggled',enable);(_this$calendar3=this.calendar)==null?void 0:(_this$calendar3$curre=_this$calendar3.current)==null?void 0:_this$calendar3$curre.scrollToDay(this.state.selectedDay,this.calendarOffset()+1,true);}},{key:\"loadReservations\",value:function loadReservations(props){var _this2=this;if((!props.items||!Object.keys(props.items).length)&&!this.state.firstReservationLoad){this.setState({firstReservationLoad:true},function(){_.invoke(_this2.props,'loadItemsForMonth',xdateToData(_this2.state.selectedDay));});}}},{key:\"chooseDay\",value:function chooseDay(d,optimisticScroll){var _this$calendar4,_this$calendar4$curre;var day=parseDate(d);this.setState({calendarScrollable:false,selectedDay:day.clone()});_.invoke(this.props,'onCalendarToggled',false);if(!optimisticScroll){this.setState({topDay:day.clone()});}this.setScrollPadPosition(this.initialScrollPadPosition(),true);(_this$calendar4=this.calendar)==null?void 0:(_this$calendar4$curre=_this$calendar4.current)==null?void 0:_this$calendar4$curre.scrollToDay(day,this.calendarOffset(),true);_.invoke(this.props,'loadItemsForMonth',xdateToData(day));_.invoke(this.props,'onDayPress',xdateToData(day));}},{key:\"renderReservations\",value:function renderReservations(){var reservationListProps=extractComponentProps(ReservationList,this.props);return React.createElement(ReservationList,_extends({},reservationListProps,{ref:this.list,reservations:this.props.items,selectedDay:this.state.selectedDay,topDay:this.state.topDay,onDayChange:this.onDayChange,onScroll:function onScroll(){}}));}},{key:\"renderCalendarList\",value:function renderCalendarList(){var _this$props=this.props,markedDates=_this$props.markedDates,items=_this$props.items;var shouldHideExtraDays=this.state.calendarScrollable?this.props.hideExtraDays:false;var calendarListProps=extractComponentProps(CalendarList,this.props);return React.createElement(CalendarList,_extends({},calendarListProps,{ref:this.calendar,current:this.currentMonth,markedDates:this.generateMarkings(this.state.selectedDay,markedDates,items),calendarWidth:this.viewWidth,scrollEnabled:this.state.calendarScrollable,hideExtraDays:shouldHideExtraDays,onLayout:this.onCalendarListLayout,onDayPress:this.chooseDayFromCalendar,onVisibleMonthsChange:this.onVisibleMonthsChange}));}},{key:\"renderKnob\",value:function renderKnob(){var _this$props2=this.props,showClosingKnob=_this$props2.showClosingKnob,hideKnob=_this$props2.hideKnob,renderKnob=_this$props2.renderKnob;var knob=React.createElement(View,{style:this.style.knobContainer});if(!hideKnob){var knobView=renderKnob?renderKnob():React.createElement(View,{style:this.style.knob});knob=!this.state.calendarScrollable||showClosingKnob?React.createElement(View,{style:this.style.knobContainer},React.createElement(View,{ref:this.knob},knobView)):null;}return knob;}},{key:\"render\",value:function render(){var _this$props3=this.props,firstDay=_this$props3.firstDay,hideKnob=_this$props3.hideKnob,style=_this$props3.style,testID=_this$props3.testID;var weekDaysNames=weekDayNames(firstDay);var agendaHeight=this.initialScrollPadPosition();var weekdaysStyle=[this.style.weekdays,{opacity:this.state.scrollY.interpolate({inputRange:[agendaHeight-HEADER_HEIGHT,agendaHeight],outputRange:[0,1],extrapolate:'clamp'}),transform:[{translateY:this.state.scrollY.interpolate({inputRange:[Math.max(0,agendaHeight-HEADER_HEIGHT),agendaHeight],outputRange:[-HEADER_HEIGHT,0],extrapolate:'clamp'})}]}];var headerTranslate=this.state.scrollY.interpolate({inputRange:[0,agendaHeight],outputRange:[agendaHeight,0],extrapolate:'clamp'});var contentTranslate=this.state.scrollY.interpolate({inputRange:[0,agendaHeight],outputRange:[0,agendaHeight/2],extrapolate:'clamp'});var headerStyle=[this.style.header,{bottom:agendaHeight,transform:[{translateY:headerTranslate}]}];if(!this.state.calendarIsReady){headerStyle.push({height:0});weekdaysStyle.push({height:HEADER_HEIGHT});}var openCalendarScrollPadPosition=!hideKnob&&this.state.calendarScrollable&&this.props.showClosingKnob?agendaHeight+HEADER_HEIGHT:0;var shouldAllowDragging=!hideKnob&&!this.state.calendarScrollable;var scrollPadPosition=(shouldAllowDragging?HEADER_HEIGHT:openCalendarScrollPadPosition)-KNOB_HEIGHT;var scrollPadStyle={height:KNOB_HEIGHT,top:scrollPadPosition,left:(this.viewWidth-80)/2};return React.createElement(View,{testID:testID,onLayout:this.onLayout,style:[style,this.style.container]},React.createElement(View,{style:this.style.reservations},this.renderReservations()),React.createElement(Animated.View,{style:headerStyle},React.createElement(Animated.View,{style:[this.style.animatedContainer,{transform:[{translateY:contentTranslate}]}]},this.renderCalendarList()),this.renderKnob()),React.createElement(Animated.View,{style:weekdaysStyle},this.renderWeekNumbersSpace(),this.renderWeekDaysNames(weekDaysNames)),React.createElement(Animated.ScrollView,{ref:this.scrollPad,style:[this.style.scrollPadStyle,scrollPadStyle],overScrollMode:\"never\",showsHorizontalScrollIndicator:false,showsVerticalScrollIndicator:false,scrollEventThrottle:8,scrollsToTop:false,onTouchStart:this.onTouchStart,onTouchEnd:this.onTouchEnd,onScrollBeginDrag:this.onStartDrag,onScrollEndDrag:this.onSnapAfterDrag,onScroll:Animated.event([{nativeEvent:{contentOffset:{y:this.state.scrollY}}}],{useNativeDriver:true})},React.createElement(View,{testID:AGENDA_CALENDAR_KNOB,style:{height:agendaHeight+KNOB_HEIGHT},onLayout:this.onScrollPadLayout})));}}],[{key:\"getDerivedStateFromProps\",value:function getDerivedStateFromProps(nextProps){if(nextProps.items){return{firstReservationLoad:false};}return null;}}]);return Agenda;}(Component);Agenda.displayName='Agenda';Agenda.propTypes=_objectSpread(_objectSpread(_objectSpread({},CalendarList.propTypes),ReservationList.propTypes),{},{style:PropTypes.oneOfType([PropTypes.object,PropTypes.array,PropTypes.number]),items:PropTypes.object,loadItemsForMonth:PropTypes.func,onCalendarToggled:PropTypes.func,onDayPress:PropTypes.func,onDayChange:PropTypes.func,renderKnob:PropTypes.func,selected:PropTypes.any,hideKnob:PropTypes.bool,showClosingKnob:PropTypes.bool});export{Agenda as default};","map":{"version":3,"sources":["/app/node_modules/react-native-calendars/src/agenda/index.js"],"names":["_","PropTypes","XDate","memoize","React","Component","extractComponentProps","parseDate","xdateToData","toMarkingFormat","weekDayNames","sameDate","sameMonth","AGENDA_CALENDAR_KNOB","VelocityTracker","styleConstructor","CalendarList","ReservationList","HEADER_HEIGHT","KNOB_HEIGHT","Agenda","props","scrollPad","createRef","calendar","knob","list","initialScrollPadPosition","Math","max","viewHeight","setScrollPadPosition","y","animated","current","scrollTo","x","getNode","toggleCalendarPosition","open","maxY","enableCalendarScrolling","chooseDayFromCalendar","d","chooseDay","state","calendarScrollable","generateMarkings","selectedDay","markedDates","items","Object","keys","forEach","key","length","marked","selected","onScrollPadLayout","setTimeout","setState","calendarIsReady","onCalendarListLayout","scrollToDay","clone","calendarOffset","onLayout","event","nativeEvent","layout","height","viewWidth","width","forceUpdate","onTouchStart","headerState","setNativeProps","style","opacity","onTouchEnd","isOpen","onStartDrag","knobTracker","reset","onSnapAfterDrag","e","currentY","contentOffset","add","projectedY","estimateSpeed","snapY","onVisibleMonthsChange","months","invoke","firstReservationLoad","clearTimeout","scrollTimeout","_isMounted","onDayChange","day","newDate","withAnimation","renderWeekDaysNames","weekDaysNames","map","index","weekday","renderWeekNumbersSpace","showWeekNumbers","theme","windowSize","Dimensions","get","undefined","scrollY","Animated","Value","topDay","currentMonth","addListener","value","loadReservations","removeAllListeners","prevProps","enable","optimisticScroll","reservationListProps","shouldHideExtraDays","hideExtraDays","calendarListProps","showClosingKnob","hideKnob","renderKnob","knobContainer","knobView","firstDay","testID","agendaHeight","weekdaysStyle","weekdays","interpolate","inputRange","outputRange","extrapolate","transform","translateY","headerTranslate","contentTranslate","headerStyle","header","bottom","push","openCalendarScrollPadPosition","shouldAllowDragging","scrollPadPosition","scrollPadStyle","top","left","container","reservations","renderReservations","animatedContainer","renderCalendarList","useNativeDriver","nextProps","displayName","propTypes","oneOfType","object","array","number","loadItemsForMonth","func","onCalendarToggled","onDayPress","any","bool"],"mappings":"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","sourcesContent":["import _ from 'lodash';\nimport PropTypes from 'prop-types';\nimport XDate from 'xdate';\nimport memoize from 'memoize-one';\nimport React, { Component } from 'react';\nimport { Text, View, Dimensions, Animated } from 'react-native';\n// @ts-expect-error\nimport { extractComponentProps } from '../component-updater.js';\n// @ts-expect-error\nimport { parseDate, xdateToData, toMarkingFormat } from '../interface';\n// @ts-expect-error\nimport { weekDayNames, sameDate, sameMonth } from '../dateutils';\n// @ts-expect-error\nimport { AGENDA_CALENDAR_KNOB } from '../testIDs';\n// @ts-expect-error\nimport { VelocityTracker } from '../input';\nimport styleConstructor from './style';\nimport CalendarList from '../calendar-list';\nimport ReservationList from './reservation-list';\nconst HEADER_HEIGHT = 104;\nconst KNOB_HEIGHT = 24;\n/**\n * @description: Agenda component\n * @extends: CalendarList\n * @extendslink: docs/CalendarList\n * @example: https://github.com/wix/react-native-calendars/blob/master/example/src/screens/agenda.js\n * @gif: https://github.com/wix/react-native-calendars/blob/master/demo/agenda.gif\n */\nexport default class Agenda extends Component {\n    static displayName = 'Agenda';\n    static propTypes = {\n        ...CalendarList.propTypes,\n        ...ReservationList.propTypes,\n        /** agenda container style */\n        style: PropTypes.oneOfType([PropTypes.object, PropTypes.array, PropTypes.number]),\n        /** the list of items that have to be displayed in agenda. If you want to render item as empty date\n         the value of date key has to be an empty array []. If there exists no value for date key it is\n         considered that the date in question is not yet loaded */\n        items: PropTypes.object,\n        /** callback that gets called when items for a certain month should be loaded (month became visible) */\n        loadItemsForMonth: PropTypes.func,\n        /** callback that fires when the calendar is opened or closed */\n        onCalendarToggled: PropTypes.func,\n        /** callback that gets called on day press */\n        onDayPress: PropTypes.func,\n        /** callback that gets called when day changes while scrolling agenda list */\n        onDayChange: PropTypes.func,\n        /** specify how agenda knob should look like */\n        renderKnob: PropTypes.func,\n        /** initially selected day */\n        selected: PropTypes.any,\n        /** Hide knob button. Default = false */\n        hideKnob: PropTypes.bool,\n        /** When `true` and `hideKnob` prop is `false`, the knob will always be visible and the user will be able to drag the knob up and close the calendar. Default = false */\n        showClosingKnob: PropTypes.bool\n    };\n    style;\n    viewHeight;\n    viewWidth;\n    scrollTimeout;\n    headerState;\n    currentMonth;\n    knobTracker;\n    _isMounted;\n    scrollPad = React.createRef();\n    calendar = React.createRef();\n    knob = React.createRef();\n    list = React.createRef();\n    constructor(props) {\n        super(props);\n        this.style = styleConstructor(props.theme);\n        const windowSize = Dimensions.get('window');\n        this.viewHeight = windowSize.height;\n        this.viewWidth = windowSize.width;\n        this.scrollTimeout = undefined;\n        this.headerState = 'idle';\n        this.state = {\n            scrollY: new Animated.Value(0),\n            calendarIsReady: false,\n            calendarScrollable: false,\n            firstReservationLoad: false,\n            selectedDay: parseDate(props.selected) || new XDate(true),\n            topDay: parseDate(props.selected) || new XDate(true)\n        };\n        this.currentMonth = this.state.selectedDay.clone();\n        this.knobTracker = new VelocityTracker();\n        this.state.scrollY.addListener(({ value }) => this.knobTracker.add(value));\n    }\n    componentDidMount() {\n        this._isMounted = true;\n        this.loadReservations(this.props);\n    }\n    componentWillUnmount() {\n        this._isMounted = false;\n        this.state.scrollY.removeAllListeners();\n    }\n    componentDidUpdate(prevProps) {\n        if (this.props.selected && !sameDate(parseDate(this.props.selected), parseDate(prevProps.selected))) {\n            this.setState({ selectedDay: parseDate(this.props.selected) });\n        }\n        else if (!prevProps.items) {\n            this.loadReservations(this.props);\n        }\n    }\n    static getDerivedStateFromProps(nextProps) {\n        if (nextProps.items) {\n            return { firstReservationLoad: false };\n        }\n        return null;\n    }\n    calendarOffset() {\n        return 96 - this.viewHeight / 2;\n    }\n    initialScrollPadPosition = () => {\n        return Math.max(0, this.viewHeight - HEADER_HEIGHT);\n    };\n    setScrollPadPosition = (y, animated) => {\n        if (this.scrollPad?.current?.scrollTo) {\n            this.scrollPad.current.scrollTo({ x: 0, y, animated });\n        }\n        else {\n            // Support for RN O.61 (Expo 37)\n            this.scrollPad?.current?.getNode().scrollTo({ x: 0, y, animated });\n        }\n    };\n    toggleCalendarPosition = (open) => {\n        const maxY = this.initialScrollPadPosition();\n        this.setScrollPadPosition(open ? 0 : maxY, true);\n        this.enableCalendarScrolling(open);\n    };\n    enableCalendarScrolling(enable = true) {\n        this.setState({\n            calendarScrollable: enable\n        });\n        _.invoke(this.props, 'onCalendarToggled', enable);\n        // Enlarge calendarOffset here as a workaround on iOS to force repaint.\n        // Otherwise the month after current one or before current one remains invisible.\n        // The problem is caused by overflow: 'hidden' style, which we need for dragging\n        // to be performant.\n        // Another working solution for this bug would be to set removeClippedSubviews={false}\n        // in CalendarList listView, but that might impact performance when scrolling\n        // month list in expanded CalendarList.\n        // Further info https://github.com/facebook/react-native/issues/1831\n        this.calendar?.current?.scrollToDay(this.state.selectedDay, this.calendarOffset() + 1, true);\n    }\n    loadReservations(props) {\n        if ((!props.items || !Object.keys(props.items).length) && !this.state.firstReservationLoad) {\n            this.setState({\n                firstReservationLoad: true\n            }, () => {\n                _.invoke(this.props, 'loadItemsForMonth', xdateToData(this.state.selectedDay));\n            });\n        }\n    }\n    chooseDayFromCalendar = (d) => {\n        this.chooseDay(d, !this.state.calendarScrollable);\n    };\n    chooseDay(d, optimisticScroll) {\n        const day = parseDate(d);\n        this.setState({\n            calendarScrollable: false,\n            selectedDay: day.clone()\n        });\n        _.invoke(this.props, 'onCalendarToggled', false);\n        if (!optimisticScroll) {\n            this.setState({\n                topDay: day.clone()\n            });\n        }\n        this.setScrollPadPosition(this.initialScrollPadPosition(), true);\n        this.calendar?.current?.scrollToDay(day, this.calendarOffset(), true);\n        _.invoke(this.props, 'loadItemsForMonth', xdateToData(day));\n        _.invoke(this.props, 'onDayPress', xdateToData(day));\n    }\n    generateMarkings = memoize((selectedDay, markedDates, items = {}) => {\n        if (!markedDates) {\n            markedDates = {};\n            Object.keys(items).forEach(key => {\n                if (items[key] && items[key].length) {\n                    markedDates[key] = { marked: true };\n                }\n            });\n        }\n        const key = toMarkingFormat(selectedDay);\n        return { ...markedDates, [key]: { ...(markedDates[key] || {}), ...{ selected: true } } };\n    });\n    onScrollPadLayout = () => {\n        // When user touches knob, the actual component that receives touch events is a ScrollView.\n        // It needs to be scrolled to the bottom, so that when user moves finger downwards,\n        // scroll position actually changes (it would stay at 0, when scrolled to the top).\n        this.setScrollPadPosition(this.initialScrollPadPosition(), false);\n        // delay rendering calendar in full height because otherwise it still flickers sometimes\n        setTimeout(() => this.setState({ calendarIsReady: true }), 0);\n    };\n    onCalendarListLayout = () => {\n        this.calendar?.current?.scrollToDay(this.state.selectedDay.clone(), this.calendarOffset(), false);\n    };\n    onLayout = (event) => {\n        this.viewHeight = event.nativeEvent.layout.height;\n        this.viewWidth = event.nativeEvent.layout.width;\n        this.forceUpdate();\n    };\n    onTouchStart = () => {\n        this.headerState = 'touched';\n        this.knob?.current?.setNativeProps({ style: { opacity: 0.5 } });\n    };\n    onTouchEnd = () => {\n        this.knob?.current?.setNativeProps({ style: { opacity: 1 } });\n        if (this.headerState === 'touched') {\n            const isOpen = this.state.calendarScrollable;\n            this.toggleCalendarPosition(!isOpen);\n        }\n        this.headerState = 'idle';\n    };\n    onStartDrag = () => {\n        this.headerState = 'dragged';\n        this.knobTracker.reset();\n    };\n    onSnapAfterDrag = (e) => {\n        // on Android onTouchEnd is not called if dragging was started\n        this.onTouchEnd();\n        const currentY = e.nativeEvent.contentOffset.y;\n        this.knobTracker.add(currentY);\n        const projectedY = currentY + this.knobTracker.estimateSpeed() * 250; /*ms*/\n        const maxY = this.initialScrollPadPosition();\n        const snapY = projectedY > maxY / 2 ? maxY : 0;\n        this.setScrollPadPosition(snapY, true);\n        this.enableCalendarScrolling(snapY === 0);\n    };\n    onVisibleMonthsChange = (months) => {\n        _.invoke(this.props, 'onVisibleMonthsChange', months);\n        if (this.props.items && !this.state.firstReservationLoad) {\n            clearTimeout(this.scrollTimeout);\n            this.scrollTimeout = setTimeout(() => {\n                if (this._isMounted) {\n                    _.invoke(this.props, 'loadItemsForMonth', months[0]);\n                }\n            }, 200);\n        }\n    };\n    onDayChange = (day) => {\n        const newDate = parseDate(day);\n        const withAnimation = sameMonth(newDate, this.state.selectedDay);\n        this.calendar?.current?.scrollToDay(day, this.calendarOffset(), withAnimation);\n        this.setState({\n            selectedDay: newDate\n        });\n        _.invoke(this.props, 'onDayChange', xdateToData(newDate));\n    };\n    renderReservations() {\n        const reservationListProps = extractComponentProps(ReservationList, this.props);\n        return (<ReservationList {...reservationListProps} ref={this.list} reservations={this.props.items} selectedDay={this.state.selectedDay} topDay={this.state.topDay} onDayChange={this.onDayChange} onScroll={() => { }}/>);\n    }\n    renderCalendarList() {\n        const { markedDates, items } = this.props;\n        const shouldHideExtraDays = this.state.calendarScrollable ? this.props.hideExtraDays : false;\n        const calendarListProps = extractComponentProps(CalendarList, this.props);\n        return (<CalendarList {...calendarListProps} ref={this.calendar} current={this.currentMonth} markedDates={this.generateMarkings(this.state.selectedDay, markedDates, items)} calendarWidth={this.viewWidth} scrollEnabled={this.state.calendarScrollable} hideExtraDays={shouldHideExtraDays} onLayout={this.onCalendarListLayout} onDayPress={this.chooseDayFromCalendar} onVisibleMonthsChange={this.onVisibleMonthsChange}/>);\n    }\n    renderKnob() {\n        const { showClosingKnob, hideKnob, renderKnob } = this.props;\n        let knob = <View style={this.style.knobContainer}/>;\n        if (!hideKnob) {\n            const knobView = renderKnob ? renderKnob() : <View style={this.style.knob}/>;\n            knob = !this.state.calendarScrollable || showClosingKnob ? (<View style={this.style.knobContainer}>\n          <View ref={this.knob}>{knobView}</View>\n        </View>) : null;\n        }\n        return knob;\n    }\n    renderWeekDaysNames = memoize((weekDaysNames) => {\n        return weekDaysNames.map((day, index) => (<Text allowFontScaling={false} key={day + index} style={this.style.weekday} numberOfLines={1}>\n        {day}\n      </Text>));\n    });\n    renderWeekNumbersSpace = () => {\n        return this.props.showWeekNumbers && <View style={this.style.weekday}/>;\n    };\n    render() {\n        const { firstDay, hideKnob, style, testID } = this.props;\n        const weekDaysNames = weekDayNames(firstDay);\n        const agendaHeight = this.initialScrollPadPosition();\n        const weekdaysStyle = [\n            this.style.weekdays,\n            {\n                opacity: this.state.scrollY.interpolate({\n                    inputRange: [agendaHeight - HEADER_HEIGHT, agendaHeight],\n                    outputRange: [0, 1],\n                    extrapolate: 'clamp'\n                }),\n                transform: [\n                    {\n                        translateY: this.state.scrollY.interpolate({\n                            inputRange: [Math.max(0, agendaHeight - HEADER_HEIGHT), agendaHeight],\n                            outputRange: [-HEADER_HEIGHT, 0],\n                            extrapolate: 'clamp'\n                        })\n                    }\n                ]\n            }\n        ];\n        const headerTranslate = this.state.scrollY.interpolate({\n            inputRange: [0, agendaHeight],\n            outputRange: [agendaHeight, 0],\n            extrapolate: 'clamp'\n        });\n        const contentTranslate = this.state.scrollY.interpolate({\n            inputRange: [0, agendaHeight],\n            outputRange: [0, agendaHeight / 2],\n            extrapolate: 'clamp'\n        });\n        const headerStyle = [\n            this.style.header,\n            {\n                bottom: agendaHeight,\n                transform: [{ translateY: headerTranslate }]\n            }\n        ];\n        if (!this.state.calendarIsReady) {\n            // limit header height until everything is setup for calendar dragging\n            headerStyle.push({ height: 0 });\n            // fill header with appStyle.calendarBackground background to reduce flickering\n            weekdaysStyle.push({ height: HEADER_HEIGHT });\n        }\n        const openCalendarScrollPadPosition = !hideKnob && this.state.calendarScrollable && this.props.showClosingKnob ? agendaHeight + HEADER_HEIGHT : 0;\n        const shouldAllowDragging = !hideKnob && !this.state.calendarScrollable;\n        const scrollPadPosition = (shouldAllowDragging ? HEADER_HEIGHT : openCalendarScrollPadPosition) - KNOB_HEIGHT;\n        const scrollPadStyle = {\n            height: KNOB_HEIGHT,\n            top: scrollPadPosition,\n            left: (this.viewWidth - 80) / 2\n        };\n        return (<View testID={testID} onLayout={this.onLayout} style={[style, this.style.container]}>\n        <View style={this.style.reservations}>{this.renderReservations()}</View>\n        <Animated.View style={headerStyle}>\n          <Animated.View style={[this.style.animatedContainer, { transform: [{ translateY: contentTranslate }] }]}>\n            {this.renderCalendarList()}\n          </Animated.View>\n          {this.renderKnob()}\n        </Animated.View>\n        <Animated.View style={weekdaysStyle}>\n          {this.renderWeekNumbersSpace()}\n          {this.renderWeekDaysNames(weekDaysNames)}\n        </Animated.View>\n        <Animated.ScrollView ref={this.scrollPad} style={[this.style.scrollPadStyle, scrollPadStyle]} overScrollMode=\"never\" showsHorizontalScrollIndicator={false} showsVerticalScrollIndicator={false} scrollEventThrottle={8} scrollsToTop={false} onTouchStart={this.onTouchStart} onTouchEnd={this.onTouchEnd} onScrollBeginDrag={this.onStartDrag} onScrollEndDrag={this.onSnapAfterDrag} onScroll={Animated.event([{ nativeEvent: { contentOffset: { y: this.state.scrollY } } }], { useNativeDriver: true })}>\n          <View testID={AGENDA_CALENDAR_KNOB} style={{ height: agendaHeight + KNOB_HEIGHT }} onLayout={this.onScrollPadLayout}/>\n        </Animated.ScrollView>\n      </View>);\n    }\n}\n"]},"metadata":{},"sourceType":"module"}