{"ast":null,"code":"\"use strict\";var _slicedToArray=require(\"@babel/runtime/helpers/slicedToArray\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=useImageNaturalDimensions;var _react=require(\"react\");var _reactNative=require(\"react-native-web/dist/index\");var _getDimensionsWithAspectRatio=_interopRequireDefault(require(\"./getDimensionsWithAspectRatio\"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function normalizeSize(dimension,options){var containerDimension=options.containerDimension||null;var enablePercentWidth=options.enablePercentWidth||false;if(dimension===null||dimension===undefined||Number.isNaN(dimension)){return null;}if(typeof dimension==='number'){return dimension;}if(dimension.search('%')!==-1&&enablePercentWidth&&typeof containerDimension==='number'){return parseFloat(dimension)*containerDimension/100;}else if(dimension.trim().match(/^[\\d.]+$/)){return parseFloat(dimension);}return null;}function deriveSpecifiedDimensionsFromProps(_ref){var width=_ref.width,height=_ref.height,contentWidth=_ref.contentWidth,flatStyle=_ref.flatStyle,enablePercentWidth=_ref.enableExperimentalPercentWidth;var normalizeOptionsWidth={enablePercentWidth:enablePercentWidth,containerDimension:contentWidth};var normalizeOptionsHeight={enablePercentWidth:false};var widthProp=normalizeSize(width,normalizeOptionsWidth);var heightProp=normalizeSize(height,normalizeOptionsHeight);var styleWidth=normalizeSize(flatStyle.width,normalizeOptionsWidth);var styleHeight=normalizeSize(flatStyle.height,normalizeOptionsHeight);return(0,_getDimensionsWithAspectRatio.default)(styleWidth!==null&&styleWidth!==void 0?styleWidth:widthProp,styleHeight!==null&&styleHeight!==void 0?styleHeight:heightProp,flatStyle.aspectRatio);}function useImageNaturalDimensions(props){var source=props.source,contentWidth=props.contentWidth,enableExperimentalPercentWidth=props.enableExperimentalPercentWidth,width=props.width,height=props.height,style=props.style,cachedNaturalDimensions=props.cachedNaturalDimensions;var _ref2=(0,_react.useState)(cachedNaturalDimensions||null),_ref3=_slicedToArray(_ref2,2),naturalDimensions=_ref3[0],setNaturalDimensions=_ref3[1];var flatStyle=(0,_react.useMemo)(function(){return _reactNative.StyleSheet.flatten(style)||{};},[style]);var _ref4=cachedNaturalDimensions||{},cachedNaturalWidth=_ref4.width,cachedNaturalHeight=_ref4.height;var specifiedDimensions=(0,_react.useMemo)(function(){return deriveSpecifiedDimensionsFromProps({contentWidth:contentWidth,enableExperimentalPercentWidth:enableExperimentalPercentWidth,width:width,height:height,flatStyle:flatStyle});},[contentWidth,enableExperimentalPercentWidth,flatStyle,height,width]);var _ref5=(0,_react.useState)(null),_ref6=_slicedToArray(_ref5,2),error=_ref6[0],setError=_ref6[1];(0,_react.useEffect)(function resetOnURIChange(){setNaturalDimensions(cachedNaturalWidth!=null&&cachedNaturalHeight!=null?{width:cachedNaturalWidth,height:cachedNaturalHeight}:null);setError(null);},[cachedNaturalHeight,cachedNaturalWidth,source.uri]);return{onNaturalDimensions:setNaturalDimensions,onError:setError,naturalDimensions:naturalDimensions,specifiedDimensions:specifiedDimensions,flatStyle:flatStyle,error:error};}","map":{"version":3,"sources":["useImageNaturalDimensions.ts"],"names":["containerDimension","options","enablePercentWidth","dimension","Number","parseFloat","enableExperimentalPercentWidth","normalizeOptionsWidth","contentWidth","normalizeOptionsHeight","widthProp","normalizeSize","heightProp","styleWidth","flatStyle","styleHeight","cachedNaturalDimensions","StyleSheet","width","height","cachedNaturalHeight","specifiedDimensions","deriveSpecifiedDimensionsFromProps","setNaturalDimensions","setError","source","onNaturalDimensions","onError","naturalDimensions","error"],"mappings":"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","sourcesContent":["import { useState, useMemo, useEffect } from 'react';\nimport { StyleSheet } from 'react-native';\nimport { ImageDimensions } from '../shared-types';\nimport getDimensionsWithAspectRatio from './getDimensionsWithAspectRatio';\nimport { UseIMGElementStateProps } from './img-types';\n\ninterface IncompleteImageDimensions {\n  width: number | null;\n  height: number | null;\n}\n\nfunction normalizeSize(\n  dimension: string | number | null | undefined,\n  options: Partial<{\n    containerDimension: number | null;\n    enablePercentWidth: boolean;\n  }>\n) {\n  const containerDimension = options.containerDimension || null;\n  const enablePercentWidth = options.enablePercentWidth || false;\n  if (\n    dimension === null ||\n    dimension === undefined ||\n    Number.isNaN(dimension)\n  ) {\n    return null;\n  }\n  if (typeof dimension === 'number') {\n    return dimension;\n  }\n  if (\n    dimension.search('%') !== -1 &&\n    enablePercentWidth &&\n    typeof containerDimension === 'number'\n  ) {\n    return (parseFloat(dimension) * containerDimension) / 100;\n  } else if (dimension.trim().match(/^[\\d.]+$/)) {\n    return parseFloat(dimension);\n  }\n  return null;\n}\n\n/**\n * Extract specified dimensions from props.\n */\nfunction deriveSpecifiedDimensionsFromProps({\n  width,\n  height,\n  contentWidth,\n  flatStyle,\n  enableExperimentalPercentWidth: enablePercentWidth\n}: Pick<\n  UseIMGElementStateProps,\n  'width' | 'height' | 'contentWidth' | 'enableExperimentalPercentWidth'\n> & { flatStyle: Record<string, any> }): IncompleteImageDimensions {\n  const normalizeOptionsWidth = {\n    enablePercentWidth,\n    containerDimension: contentWidth\n  };\n  const normalizeOptionsHeight = {\n    enablePercentWidth: false\n  };\n  const widthProp = normalizeSize(width, normalizeOptionsWidth);\n  const heightProp = normalizeSize(height, normalizeOptionsHeight);\n  const styleWidth = normalizeSize(flatStyle.width, normalizeOptionsWidth);\n  const styleHeight = normalizeSize(flatStyle.height, normalizeOptionsHeight);\n  return getDimensionsWithAspectRatio(\n    styleWidth ?? widthProp,\n    styleHeight ?? heightProp,\n    flatStyle.aspectRatio\n  );\n}\n\nexport default function useImageNaturalDimensions<\n  P extends UseIMGElementStateProps\n>(props: P) {\n  const {\n    source,\n    contentWidth,\n    enableExperimentalPercentWidth,\n    width,\n    height,\n    style,\n    cachedNaturalDimensions\n  } = props;\n  const [naturalDimensions, setNaturalDimensions] = useState<\n    P['cachedNaturalDimensions'] extends ImageDimensions\n      ? ImageDimensions\n      : ImageDimensions | null\n  >((cachedNaturalDimensions as any) || null);\n  const flatStyle = useMemo(() => StyleSheet.flatten(style) || {}, [style]);\n  const { width: cachedNaturalWidth, height: cachedNaturalHeight } =\n    cachedNaturalDimensions || {};\n  const specifiedDimensions = useMemo(\n    () =>\n      deriveSpecifiedDimensionsFromProps({\n        contentWidth,\n        enableExperimentalPercentWidth,\n        width,\n        height,\n        flatStyle\n      }),\n    [contentWidth, enableExperimentalPercentWidth, flatStyle, height, width]\n  );\n  const [error, setError] = useState<null | Error>(null);\n  useEffect(\n    function resetOnURIChange() {\n      setNaturalDimensions(\n        (cachedNaturalWidth != null && cachedNaturalHeight != null\n          ? { width: cachedNaturalWidth, height: cachedNaturalHeight }\n          : null) as any\n      );\n      setError(null);\n    },\n    [cachedNaturalHeight, cachedNaturalWidth, source.uri]\n  );\n  return {\n    onNaturalDimensions: setNaturalDimensions,\n    onError: setError,\n    naturalDimensions,\n    specifiedDimensions,\n    flatStyle,\n    error\n  };\n}\n"]},"metadata":{},"sourceType":"script"}