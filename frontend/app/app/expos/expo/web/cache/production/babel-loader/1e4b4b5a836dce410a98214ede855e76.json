{"ast":null,"code":"import _regeneratorRuntime from\"@babel/runtime/regenerator\";import _slicedToArray from\"@babel/runtime/helpers/slicedToArray\";import React,{useState,useEffect,useRef}from\"react\";import StyleSheet from\"react-native-web/dist/exports/StyleSheet\";import SafeAreaView from\"react-native-web/dist/exports/SafeAreaView\";import View from\"react-native-web/dist/exports/View\";import Text from\"react-native-web/dist/exports/Text\";import FlatList from\"react-native-web/dist/exports/FlatList\";import ActivityIndicator from\"react-native-web/dist/exports/ActivityIndicator\";import Constants from\"expo-constants\";import{uniqBy}from\"lodash\";import{getNews}from\"./apis\";import Article from\"./Article\";var PAGE_SIZE=20;var PRIMARY_COLOR=\"#e74c3c\";export default function WorldwideNews(){var _useState=useState(true),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setLoading=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),articles=_useState4[0],setArticles=_useState4[1];var _useState5=useState(1),_useState6=_slicedToArray(_useState5,2),page=_useState6[0],setPage=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),refreshing=_useState8[0],setRefreshing=_useState8[1];var hasMoreData=useRef(true);useEffect(function(){var fetchData=function fetchData(){var newArticles;return _regeneratorRuntime.async(function fetchData$(_context){while(1){switch(_context.prev=_context.next){case 0:if(hasMoreData.current){_context.next=2;break;}return _context.abrupt(\"return\");case 2:_context.next=4;return _regeneratorRuntime.awrap(getNews(page,PAGE_SIZE));case 4:newArticles=_context.sent;if(newArticles.length<PAGE_SIZE){hasMoreData.current=false;}setArticles(function(articles){var allArticles=articles.concat(newArticles.filter(function(article){return article.urlToImage;}));return uniqBy(allArticles,\"url\");});setLoading(false);setRefreshing(false);case 9:case\"end\":return _context.stop();}}},null,null,null,Promise);};fetchData();},[page]);var refreshData=function refreshData(){setPage(1);setRefreshing(true);setArticles([]);hasMoreData.current=true;};var renderArticle=function renderArticle(_ref){var item=_ref.item;return React.createElement(Article,{item:item});};var renderDivider=function renderDivider(){return React.createElement(View,{style:styles.articleSeparator});};var renderFooter=function renderFooter(){return React.createElement(View,{style:styles.center},hasMoreData.current&&React.createElement(ActivityIndicator,{color:PRIMARY_COLOR}));};var keyExtractor=function keyExtractor(item){return item.url;};return React.createElement(SafeAreaView,{style:styles.container},React.createElement(View,{style:styles.content},React.createElement(Text,{style:styles.headlines},\"Worldwide News\"),isLoading?React.createElement(View,{style:styles.center},React.createElement(ActivityIndicator,{size:\"large\",color:PRIMARY_COLOR})):React.createElement(FlatList,{data:articles,renderItem:renderArticle,keyExtractor:keyExtractor,showsVerticalScrollIndicator:false,ItemSeparatorComponent:renderDivider,ListFooterComponent:renderFooter,initialNumToRender:6,onEndReached:function onEndReached(){return setPage(function(page){return page+1;});},onEndReachedThreshold:1,onRefresh:refreshData,refreshing:refreshing})));}var styles=StyleSheet.create({container:{flex:1,paddingTop:Constants.statusBarHeight},content:{flex:1,padding:15},center:{flex:1,justifyContent:\"center\",alignItems:\"center\"},headlines:{fontSize:32,fontWeight:\"bold\",lineHeight:50,color:PRIMARY_COLOR},articleSeparator:{borderBottomWidth:1,borderBottomColor:\"#ed7669\"}});","map":{"version":3,"sources":["/app/examples/11-news/WorldwideNews.js"],"names":["React","useState","useEffect","useRef","Constants","uniqBy","getNews","Article","PAGE_SIZE","PRIMARY_COLOR","WorldwideNews","isLoading","setLoading","articles","setArticles","page","setPage","refreshing","setRefreshing","hasMoreData","fetchData","current","newArticles","length","allArticles","concat","filter","article","urlToImage","refreshData","renderArticle","item","renderDivider","styles","articleSeparator","renderFooter","center","keyExtractor","url","container","content","headlines","StyleSheet","create","flex","paddingTop","statusBarHeight","padding","justifyContent","alignItems","fontSize","fontWeight","lineHeight","color","borderBottomWidth","borderBottomColor"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport {\n  StyleSheet,\n  SafeAreaView,\n  View,\n  Text,\n  FlatList,\n  ActivityIndicator,\n} from \"react-native\";\nimport Constants from \"expo-constants\";\nimport { uniqBy } from \"lodash\";\nimport { getNews } from \"./apis\";\nimport Article from \"./Article\";\n\nconst PAGE_SIZE = 20;\nconst PRIMARY_COLOR = \"#e74c3c\";\n\nexport default function WorldwideNews() {\n  const [isLoading, setLoading] = useState(true);\n  const [articles, setArticles] = useState([]);\n  const [page, setPage] = useState(1);\n  const [refreshing, setRefreshing] = useState(false);\n  const hasMoreData = useRef(true);\n\n  useEffect(() => {\n    const fetchData = async () => {\n      if (!hasMoreData.current) return;\n\n      const newArticles = await getNews(page, PAGE_SIZE);\n\n      if (newArticles.length < PAGE_SIZE) {\n        hasMoreData.current = false;\n      }\n\n      setArticles((articles) => {\n        // Combine and filter article has no image\n        const allArticles = articles.concat(\n          newArticles.filter((article) => article.urlToImage)\n        );\n\n        // Remove duplicate articles\n        // https://lodash.com/docs/4.17.15#uniqBy\n        return uniqBy(allArticles, \"url\");\n      });\n      setLoading(false);\n      setRefreshing(false);\n    };\n\n    fetchData();\n  }, [page]);\n\n  const refreshData = () => {\n    setPage(1);\n    setRefreshing(true);\n    setArticles([]);\n    hasMoreData.current = true;\n  };\n\n  const renderArticle = ({ item }) => <Article item={item} />;\n  const renderDivider = () => <View style={styles.articleSeparator}></View>;\n  const renderFooter = () => (\n    <View style={styles.center}>\n      {hasMoreData.current && <ActivityIndicator color={PRIMARY_COLOR} />}\n    </View>\n  );\n  const keyExtractor = (item) => item.url;\n\n  return (\n    <SafeAreaView style={styles.container}>\n      <View style={styles.content}>\n        <Text style={styles.headlines}>Worldwide News</Text>\n\n        {isLoading ? (\n          <View style={styles.center}>\n            {/* https://reactnative.dev/docs/activityindicator */}\n            <ActivityIndicator size=\"large\" color={PRIMARY_COLOR} />\n          </View>\n        ) : (\n          // Optimizing FlatList: https://reactnative.dev/docs/optimizing-flatlist-configuration\n          <FlatList\n            data={articles}\n            renderItem={renderArticle}\n            keyExtractor={keyExtractor}\n            showsVerticalScrollIndicator={false}\n            ItemSeparatorComponent={renderDivider}\n            ListFooterComponent={renderFooter}\n            initialNumToRender={6}\n            onEndReached={() => setPage((page) => page + 1)}\n            onEndReachedThreshold={1}\n            onRefresh={refreshData}\n            refreshing={refreshing}\n          />\n        )}\n      </View>\n    </SafeAreaView>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    paddingTop: Constants.statusBarHeight,\n  },\n  content: {\n    flex: 1,\n    padding: 15,\n  },\n  center: {\n    flex: 1,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n  },\n  headlines: {\n    fontSize: 32,\n    fontWeight: \"bold\",\n    lineHeight: 50,\n    color: PRIMARY_COLOR,\n  },\n  articleSeparator: {\n    borderBottomWidth: 1,\n    borderBottomColor: \"#ed7669\",\n  },\n});\n"]},"metadata":{},"sourceType":"module"}